<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Api.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Api.html">Api</a><ul class='methods'><li data-type='method'><a href="Api.html#.operation">operation</a></li><li data-type='method'><a href="Api.html#.spec">spec</a></li></ul></li></ul><h3>Modules</h3><ul><li><a href="module-md.html">md</a><ul class='methods'><li data-type='method'><a href="module-md.html#.emojis">emojis</a></li><li data-type='method'><a href="module-md.html#.md">md</a></li></ul></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">Api.js</h1>
    
    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Api is a class for loading an OpenAPI spec that you can fetch operations from.
 *
 * @exports Api
 * @see Operation
 * @class Api
 * @property {String} url An URL to the OpenAPI specification.
 */

import Operation from '../store/Operation';

export default class Api {
  constructor(url) {
    this.protocol = location.protocol;
    this.url = url;
  }

  /**
   * operation() is used to create a new {@link Operation} object by operation
   * ID.
   *
   * @example
   * const getUserOp = api.operation('getUser');
   * const getUserOp = api.operation('getUser', {connections: true});
   *
   * @memberof Api
   * @param {String} operationId An operation ID in the spec.
   * @param {Object} defaultParams An Object holding default "Operation" parameters. (optional)
   * @returns An Operation object.
   */
  operation(operationId, defaultParams) {
    const op = new Operation({api: this, id: operationId, defaultParams});
    op.req.headers = {'Content-Type': 'application/json'};
    return op;
  }

  /**
   * spec() will return the specification for a given operation Id or the whole
   * spec, if no operation is specified.
   *
   * @example
   * const apiSpec = await api.spec();
   * const getUserOpSpec = await api.spec('getUser');
   *
   * @memberof Api
   * @param {String} operationId An operation ID in the spec.
   * @returns {Object} Either the complete API spec or the spec for a single operation.
   */
  async spec(operationId) {
    if (this._ops &amp;&amp; operationId) return this._ops[operationId];
    if (this._spec) return this._spec;

    const res = await fetch(this.url);
    const spec = await res.json();
    this._ops = {};
    this._spec = spec;

    Object.keys(spec.paths).forEach(path => {
      Object.keys(spec.paths[path]).forEach(method => {
        const op = spec.paths[path][method];
        const operationId = op.operationId;
        if (!operationId) return;

        op.method = method.toUpperCase();
        op.url = this.protocol + '//' + spec.host + spec.basePath + path + '.json';
        op.parameters = (op.parameters || []).map(p => {
          if (!p['$ref']) return p;
          const refPath = p['$ref'].replace(/^#\//, '').split('/');
          let ref = spec;
          while (refPath.length) ref = ref[refPath.shift()];
          return ref;
        });

        this._ops[operationId] = op;
      });
    });

    if (this._ops &amp;&amp; operationId) return this._ops[operationId];
    if (this._spec) return this._spec;
  }
}</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.3</a> on Mon Oct 28 2019 08:20:07 GMT+0900 (Japan Standard Time) using the Toast theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
