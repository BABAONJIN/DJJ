(function(){Vue.component("convos-chat",{props:["user"],data:function(){return{searchQuery:"",show:"",error:{}};},watch:{"settings.main":function(v,o){this.calculateMainArea();},"settings.sidebar":function(v,o){if(v==="notifications"&&Convos.settings.clearNotificationsOnOpen){var self=this;Convos.api.readNotifications({},function(err,xhr){if(!err)self.user.unread=0;});}}},methods:{calculateMainArea:function(){var main=Convos.settings.main;var i;this.show="settings";this.error={message:"Could not find dialog "+main+"."};for(i=0;i<this.user.dialogs.length;i++){var dialog=this.user.dialogs[i];if(dialog.href()==main||(i==0&&!main)){Convos.settings.main=dialog.href();dialog.update({active:true});this.show="dialog";this.error={};}
else if(dialog.active!==undefined){dialog.update({active:false});}}},header:function(){var dialog=this.user.activeDialog();return dialog&&dialog.name?dialog.name:"Convos";},search:function(e){if(!this.searchQuery.length||e.shiftKey)return;this.$refs.mainmenu.$emit("gotoDialog");this.searchQuery="";},toggleMainMenu:function(){this.settings.sidebar="";this.settings.mainMenuVisible=!this.settings.mainMenuVisible;}},ready:function(){this.calculateMainArea();},template:"<div class=\"convos-chat\">\n    <header>\n      <a href=\"#main-menu\" @click.prevent=\"toggleMainMenu\" class=\"toggle-main-menu\" :class=\"settings.mainMenuVisible ? 'active' : ''\"><i class=\"material-icons\">dehaze</i></a>\n      <div class=\"input-field\">\n        <input v-model=\"searchQuery\" @keydown.enter=\"search\" id=\"goto_anything\" type=\"search\" autocomplete=\"off\" placeholder=\"Search...\">\n        <label for=\"goto_anything\"><i class=\"material-icons\">search</i></label>\n      </div>\n      <h2>{{header()}}</h2>\n      <div class=\"convos-header-links\">\n        <a v-sidebar.literal=\"#sidebar-info\" v-tooltip.literal=\"Dialog settings\" :class=\"activeClass('sidebar-info')\">\n          <i class=\"material-icons\">info</i>\n        </a>\n        <a v-sidebar.literal=\"#notifications\" v-tooltip.literal=\"Show notifications\" class=\"notifications\" :class=\"activeClass('notifications')\">\n          <i class=\"material-icons\" :class=\"user.unread ? 'active' : ''\">{{user.unread ? \"notifications_active\" : \"notifications_none\"}}</i>\n          <b class=\"n-notifications\" v-if=\"user.unread\">{{user.unread < 100 ? user.unread : \"99+\"}}</b>\n        </a>\n      </div>\n    </header>\n    <convos-dialog-container :dialog=\"d\" :user=\"user\" v-show=\"d.active\" v-for=\"d in user.dialogs\"></convos-dialog-container>\n    <convos-settings :error=\"error\" :user=\"user\" v-if=\"show == 'settings'\"></convos-settings>\n    <component :is=\"'convos-' + settings.sidebar\" :user=\"user\" v-if=\"settings.sidebar\"></component>\n    <convos-main-menu :user=\"user\" :dialog-filter.sync=\"searchQuery\" v-ref:mainmenu></convos-main-menu>\n  </div>\n"})})();