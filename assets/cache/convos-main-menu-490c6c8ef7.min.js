(function(){Vue.component("convos-main-menu",{props:["user"],data:function(){return{q:""};},computed:{dialogs:function(){var di=function(a,b){return(b.dialog_id.length?1:0)-(a.dialog_id.length?1:0);};if(this.q){var re=new RegExp(RegExp.escape(this.q),'i');return this.user.dialogs.filter(function(d){return d.name.match(re);}).sort(function(a,b){return a.name.length-b.name.length;});}
else if(this.settings.sortDialogsBy=="lastRead"){var nTop=localStorage.getItem("lastReadnTop")||3;var dialogs=this.user.dialogs.sort(function(a,b){return(b.active||false)-(a.active||false)||di(a,b)||b.lastRead-a.lastRead;});return dialogs.slice(0,nTop).concat(dialogs.slice(nTop).sort(function(a,b){return di(a,b)||(b.unread?1:0)-(a.unread?1:0)||b.lastActive-a.lastActive||b.lastRead-a.lastRead||a.name.toLowerCase().localeCompare(b.name.toLowerCase());}));}
else{return this.user.dialogs.sort(function(a,b){var ah=a.name.toLowerCase().replace(/^\W+/,'');var bh=b.name.toLowerCase().replace(/^\W+/,'');return di(a,b)||ah.localeCompare(bh);});}}},methods:{close:function(d){this.send('/close '+d.name,d);},dialogClass:function(d,i){var cn=this.activeClass(d.href());cn.link=true;cn.dialog=d.dialog_id?true:false;if(this.q)cn.active=i?true:false;cn.frozen=d.frozen?true:false;return cn;},search:function(e){if(!this.q.length||e.shiftKey)return;this.settings.main=this.dialogs.length?this.dialogs[0].href():"#create-dialog/"+this.q;this.q="";},showConnectionInfo:function(d){return d.dialog_id&&this.user.connections.length>1;}},template:"<div :class=\"settings.mainMenuVisible ? &#39;&#39; : &#39;hidden&#39;\" class=\"convos-main-menu show-on-large\">\n    <header>\n      <convos-toggle-main-menu :user=\"user\"></convos-toggle-main-menu>\n      <div class=\"input-field\">\n        <input @keydown.enter=\"search\" autocomplete=\"off\" id=\"goto_anything\" placeholder=\"Search...\" type=\"search\" v-model=\"q\">\n        <label for=\"goto_anything\"><i class=\"material-icons\">search</i></label>\n      </div>\n    </header>\n    <div class=\"content\">\n      <div :class=\"dialogClass(d, $index)\" v-for=\"d in dialogs\">\n        <a v-link=\"d.href()\" v-tooltip=\"d.frozen\">\n          <i class=\"material-icons\">{{d.icon()}}</i> <span class=\"name\">{{d.dialog_id ? d.name : d.connection_id}}</span>\n          <span class=\"n-unread badge\" v-if=\"d.unread &amp;&amp; !d.active\" v-tooltip=\"d.unread + &#39; unread messages&#39;\">{{d.unread &lt; 50 ? d.unread : &quot;50+&quot;}}</span>\n          <span class=\"on\" v-if=\"showConnectionInfo(d)\">{{d.connection().protocol}}-{{d.connection().name}}</span>\n        </a>\n        <span @click.prevent=\"close(d)\" class=\"close badge\" v-if=\"d.dialog_id\">Ã—</span>\n      </div>\n      <div class=\"divider\"></div>\n      <div :class=\"activeClass(&#39;#create-dialog&#39;)\" class=\"link\">\n        <a class=\"simple\" v-if=\"user.connections.length\" v-link.literal=\"#create-dialog\">\n          <i class=\"material-icons\">add</i> Join dialog...\n        </a>\n      </div>\n      <div :class=\"activeClass(&#39;#connection&#39;)\" class=\"link\">\n        <a class=\"simple\" v-link.literal=\"#connection\">\n          <i class=\"material-icons\">add</i> Add connection...\n        </a>\n      </div>\n      <div :class=\"activeClass(&#39;#profile&#39;)\" class=\"link\">\n        <a class=\"simple\" v-sidebar.literal=\"#profile\">\n          <i class=\"material-icons\">account_circle</i> Edit profile\n        </a>\n      </div>\n      <div :class=\"activeClass(&#39;#help&#39;)\" class=\"link\">\n        <a class=\"simple\" v-sidebar.literal=\"#help\">\n          <i class=\"material-icons\">help</i> Help\n        </a>\n      </div>\n      <div class=\"link\">\n        <a class=\"simple\" v-link.literal=\"/api/user/logout\">\n          <i class=\"material-icons\">power_settings_new</i> Logout\n        </a>\n      </div>\n    </div>\n  </div>\n"})})();